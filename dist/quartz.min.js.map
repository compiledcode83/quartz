{"version":3,"sources":["quartz.min.js"],"names":["root","factory","define","amd","exports","module","Quartz","this","config","columnClass","columnCount","yIndices","container","document","querySelector","items","toArray","querySelectorAll","mediaQueries","window","matchMedia","bindToMediaQueries","update","isArray","Array","prototype","append","length","columns","createColumnFragments","heights","getItemHeights","refreshYIndices","distributeItemsToColumns","i","children","appendChild","concat","prepend","createColumns","heights1","heights2","getExistingItemHeights","resetYIndices","removeColumns","childNodes","remove","index","_items","indexOf","splice","numColumns","columnIndex","count","getColumnIndex","min","Math","apply","style","getComputedStyle","marginBottom","parseInt","l","push","offsetHeight","testColumn","createTestColumn","removeChild","column","createDocumentFragment","createElement","className","liveColumn","firstChild","position","left","top","width","object","a","bindToMediaQueryList","that","mqlListener","mql","matches","mediaQueryList","query","addListener"],"mappings":"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","file":"quartz.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.Quartz = factory();\n  }\n}(this, function() {\n'use strict';\n\n\nvar isArray = Array.isArray;\n\n\n/**\n * @name Quartz\n * @constructor\n *\n * @param {{}}              config\n * @param {string}          config.columnClass\n * @param {number}          [config.columnCount]\n * @param {Element|string}  config.container\n * @param {NodeList|string} config.items\n * @param {Array}           [config.mediaQueries]\n *\n */\nfunction Quartz(config) {\n  this.columnClass = config.columnClass;\n  this.columnCount = config.columnCount;\n  this.yIndices = [];\n\n  if (typeof config.container === 'string') {\n    this.container = document.querySelector(config.container);\n  }\n  else {\n    this.container = config.container;\n  }\n\n  if (typeof config.items === 'string') {\n    this.items = this.toArray(document.querySelectorAll(config.items));\n  }\n  else {\n    this.items = this.toArray(config.items);\n  }\n\n  if (config.mediaQueries && window.matchMedia) {\n    this.bindToMediaQueries(config.mediaQueries);\n  }\n  else {\n    this.update();\n  }\n}\n\n\nQuartz.prototype = {\n\n  /**\n   * @param {Element|Element[]|NodeList} items\n   */\n  append : function(items) {\n    if (typeof items.length === 'undefined') {\n      items = [items];\n    }\n\n    var container   = this.container,\n        columns     = this.createColumnFragments(),\n        columnCount = this.columnCount,\n        heights     = this.getItemHeights(items);\n\n    this.refreshYIndices();\n    this.distributeItemsToColumns(items, columns, heights);\n\n    for (var i = 0; i < columnCount; i++) {\n      container.children[i].appendChild(columns[i]);\n    }\n\n    this.items = this.items.concat(this.toArray(items));\n  },\n\n\n  /**\n   * @param {Element|Element[]|NodeList} items\n   */\n  prepend : function(items) {\n    if (typeof items.length === 'undefined') {\n      items = [items];\n    }\n\n    var columns  = this.createColumns(),\n        heights1 = this.getItemHeights(items),\n        heights2 = this.getExistingItemHeights(),\n        heights  = heights1.concat(heights2);\n\n    items = this.toArray(items).concat(this.items);\n\n    this.resetYIndices();\n    this.removeColumns();\n    this.distributeItemsToColumns(items, columns.childNodes, heights);\n    this.container.appendChild(columns);\n    this.items = items;\n  },\n\n\n  /**\n   * @param {Element|Element[]|NodeList} items\n   */\n  remove : function(items) {\n    if (typeof items.length === 'undefined') {\n      items = [items];\n    }\n\n    var _items = this.items,\n        i = items.length,\n        index;\n\n    while (i--) {\n      index = _items.indexOf(items[i]);\n      if (index !== -1) {\n        _items.splice(index, 1);\n      }\n    }\n\n    this.update();\n  },\n\n\n  /**\n   * @param {number} [numColumns]\n   */\n  update : function(numColumns) {\n    if (numColumns) this.columnCount = numColumns;\n\n    var columns = this.createColumns();\n\n    this.resetYIndices();\n\n    if (this.items.length) {\n      this.distributeItemsToColumns(this.items, columns.childNodes, this.getExistingItemHeights());\n    }\n\n    this.removeColumns();\n    this.container.appendChild(columns);\n  },\n\n\n  /**\n   * @param {Element[]|NodeList} items\n   * @param {DocumentFragment[]|NodeList} columns\n   * @param {number[]} heights\n   */\n  distributeItemsToColumns : function(items, columns, heights) {\n    var count = items.length,\n        yIndices = this.yIndices,\n        columnIndex;\n\n    for (var i = 0; i < count; i++) {\n      columnIndex = this.getColumnIndex();\n      yIndices[columnIndex] += heights[i];\n      columns[columnIndex].appendChild(items[i]);\n    }\n  },\n\n\n  /**\n   * @returns {number}\n   */\n  getColumnIndex : function() {\n    var min = Math.min.apply(Math, this.yIndices);\n    return this.yIndices.indexOf(min);\n  },\n\n\n  /**\n   * @returns {number[]}\n   */\n  getExistingItemHeights : function() {\n    var items = this.items,\n        heights = [];\n\n    if (items.length) {\n      var style = window.getComputedStyle(items[0]),\n          marginBottom = parseInt(style.marginBottom, 10);\n\n      for (var i = 0, l = items.length; i < l; i++) {\n        heights.push(items[i].offsetHeight + marginBottom);\n      }\n    }\n\n    return heights;\n  },\n\n\n  /**\n   * @param {Element[]|NodeList} items\n   * @returns {number[]}\n   */\n  getItemHeights : function(items) {\n    var testColumn = this.createTestColumn(),\n        heights = [],\n        i = 0,\n        l = items.length;\n\n    for (i; i < l; i++) {\n      testColumn.appendChild(items[i]);\n    }\n\n    this.container.appendChild(testColumn);\n\n    var style = window.getComputedStyle(items[0]),\n        marginBottom = parseInt(style.marginBottom, 10);\n\n    for (i = 0; i < l; i++) {\n      heights.push(items[i].offsetHeight + marginBottom);\n    }\n\n    this.container.removeChild(testColumn);\n\n    return heights;\n  },\n\n\n  /**\n   *\n   */\n  refreshYIndices : function() {\n    var columns = this.container.children,\n        count = columns.length,\n        yIndices = this.yIndices;\n\n    if (count) {\n      yIndices.length = 0;\n\n      for (var i = 0; i < count; i++) {\n        yIndices.push(columns[i].offsetHeight);\n      }\n    }\n  },\n\n\n  /**\n   *\n   */\n  resetYIndices : function() {\n    var count = this.columnCount,\n        yIndices = this.yIndices;\n\n    yIndices.length = 0;\n\n    while (count--) {\n      yIndices.push(0);\n    }\n  },\n\n\n  /**\n   * @returns {DocumentFragment}\n   */\n  createColumns : function() {\n    var count = this.columnCount,\n        columns = document.createDocumentFragment(),\n        column;\n\n    while (count--) {\n      column = document.createElement('div');\n      column.className = this.columnClass;\n      columns.appendChild(column);\n    }\n\n    return columns;\n  },\n\n\n  /**\n   * @returns {DocumentFragment[]}\n   */\n  createColumnFragments : function() {\n    var columns = [],\n        count = this.columnCount;\n\n    while (count--) {\n      columns.push(document.createDocumentFragment());\n    }\n\n    return columns;\n  },\n\n\n  /**\n   * @returns {Element}\n   */\n  createTestColumn : function() {\n    var column = document.createElement('div'),\n        liveColumn = this.container.firstChild;\n\n    column.className = this.columnClass;\n    column.style.position = 'absolute';\n    column.style.left = '-10000px';\n    column.style.top = '-10000px';\n\n    if (liveColumn) {\n      column.style.width = window.getComputedStyle(liveColumn).width;\n    }\n\n    return column;\n  },\n\n\n  /**\n   *\n   */\n  removeColumns : function() {\n    var container = this.container;\n\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n  },\n\n\n  /**\n   * @param {Element|Element[]|NodeList} object\n   * @returns {Element[]}\n   */\n  toArray : function(object) {\n    if (isArray(object)) return object;\n\n    var i = object.length;\n\n    if (typeof i === 'number') {\n      var a = new Array(i);\n      while (i--) { a[i] = object[i]; }\n      return a;\n    }\n\n    return [object];\n  },\n\n\n  /**\n   * @param {{query:string, columns:number}[]} mediaQueries\n   */\n  bindToMediaQueries : function(mediaQueries) {\n    var i = mediaQueries.length;\n    while (i--) {\n      this.bindToMediaQueryList(mediaQueries[i]);\n    }\n  },\n\n\n  /**\n   * @param {{query:string, columns:number}} config\n   */\n  bindToMediaQueryList : function(config) {\n    var that = this;\n\n    var mqlListener = function(mql) {\n      if (mql.matches) {\n        that.update(config.columns);\n      }\n    };\n\n    var mediaQueryList = window.matchMedia(config.query);\n    mediaQueryList.addListener(mqlListener);\n    mqlListener(mediaQueryList);\n  }\n\n};\n\nreturn Quartz;\n}));\n"],"sourceRoot":"/source/"}