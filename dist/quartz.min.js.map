{"version":3,"sources":["quartz.min.js"],"names":["root","factory","define","amd","exports","module","Quartz","this","config","columnClass","columnCount","yIndices","container","document","querySelector","items","toArray","querySelectorAll","mediaQueries","window","matchMedia","bindToMediaQueries","update","initialized","isArray","Array","prototype","append","length","columns","createColumnFragments","heights","getItemHeights","refreshYIndices","distributeItemsToColumns","i","children","appendChild","concat","prepend","createColumns","heights1","heights2","getExistingItemHeights","resetYIndices","removeColumns","childNodes","remove","index","_items","indexOf","splice","numColumns","columnIndex","count","getColumnIndex","min","Math","apply","style","getComputedStyle","marginBottom","parseInt","l","push","offsetHeight","testColumn","createTestColumn","removeChild","column","createDocumentFragment","createElement","className","liveColumn","firstChild","position","left","top","width","object","a","bindToMediaQueryList","that","mqlListener","mql","matches","mediaQueryList","query","addListener"],"mappings":"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","file":"quartz.min.js","sourcesContent":[";(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define([], factory);\n  } else if (typeof exports === 'object') {\n    module.exports = factory();\n  } else {\n    root.Quartz = factory();\n  }\n}(this, function() {\n'use strict';\n\n\nvar isArray = Array.isArray;\n\n\n/**\n * @name Quartz\n * @constructor\n *\n * @param {{}}              config\n * @param {string}          config.columnClass\n * @param {number}          [config.columnCount]\n * @param {Element|string}  config.container\n * @param {NodeList|string} config.items\n * @param {Array}           [config.mediaQueries]\n *\n */\nfunction Quartz(config) {\n  this.columnClass = config.columnClass;\n  this.columnCount = config.columnCount;\n  this.yIndices = [];\n\n  if (typeof config.container === 'string') {\n    this.container = document.querySelector(config.container);\n  }\n  else {\n    this.container = config.container;\n  }\n\n  if (typeof config.items === 'string') {\n    this.items = this.toArray(document.querySelectorAll(config.items));\n  }\n  else {\n    this.items = this.toArray(config.items);\n  }\n\n  if (config.mediaQueries && window.matchMedia) {\n    this.bindToMediaQueries(config.mediaQueries);\n  }\n  else {\n    this.update();\n  }\n\n  this.initialized = true;\n}\n\n\nQuartz.prototype = {\n\n  /**\n   * @param {Element|Element[]|NodeList} items\n   */\n  append : function(items) {\n    if (typeof items.length === 'undefined') {\n      items = [items];\n    }\n\n    var container   = this.container,\n        columns     = this.createColumnFragments(),\n        columnCount = this.columnCount,\n        heights     = this.getItemHeights(items);\n\n    this.refreshYIndices();\n    this.distributeItemsToColumns(items, columns, heights);\n\n    for (var i = 0; i < columnCount; i++) {\n      container.children[i].appendChild(columns[i]);\n    }\n\n    this.items = this.items.concat(this.toArray(items));\n  },\n\n\n  /**\n   * @param {Element|Element[]|NodeList} items\n   */\n  prepend : function(items) {\n    if (typeof items.length === 'undefined') {\n      items = [items];\n    }\n\n    var columns  = this.createColumns(),\n        heights1 = this.getItemHeights(items),\n        heights2 = this.getExistingItemHeights(),\n        heights  = heights1.concat(heights2);\n\n    items = this.toArray(items).concat(this.items);\n\n    this.resetYIndices();\n    this.removeColumns();\n    this.distributeItemsToColumns(items, columns.childNodes, heights);\n    this.container.appendChild(columns);\n    this.items = items;\n  },\n\n\n  /**\n   * @param {Element|Element[]|NodeList} items\n   */\n  remove : function(items) {\n    if (typeof items.length === 'undefined') {\n      items = [items];\n    }\n\n    var _items = this.items,\n        i = items.length,\n        index;\n\n    while (i--) {\n      index = _items.indexOf(items[i]);\n      if (index !== -1) {\n        _items.splice(index, 1);\n      }\n    }\n\n    this.update();\n  },\n\n\n  /**\n   * @param {number} [numColumns]\n   */\n  update : function(numColumns) {\n    if (numColumns) this.columnCount = numColumns;\n\n    var columns = this.createColumns();\n\n    this.resetYIndices();\n\n    if (this.items.length) {\n      var heights = this.initialized ? this.getExistingItemHeights() : this.getItemHeights(this.items);\n      this.distributeItemsToColumns(this.items, columns.childNodes, heights);\n    }\n\n    this.removeColumns();\n    this.container.appendChild(columns);\n  },\n\n\n  /**\n   * @param {Element[]|NodeList} items\n   * @param {DocumentFragment[]|NodeList} columns\n   * @param {number[]} heights\n   */\n  distributeItemsToColumns : function(items, columns, heights) {\n    var count = items.length,\n        yIndices = this.yIndices,\n        columnIndex;\n\n    for (var i = 0; i < count; i++) {\n      columnIndex = this.getColumnIndex();\n      yIndices[columnIndex] += heights[i];\n      columns[columnIndex].appendChild(items[i]);\n    }\n  },\n\n\n  /**\n   * @returns {number}\n   */\n  getColumnIndex : function() {\n    var min = Math.min.apply(Math, this.yIndices);\n    return this.yIndices.indexOf(min);\n  },\n\n\n  /**\n   * @returns {number[]}\n   */\n  getExistingItemHeights : function() {\n    var items = this.items,\n        heights = [];\n\n    if (items.length) {\n      var style = window.getComputedStyle(items[0]),\n          marginBottom = parseInt(style.marginBottom, 10);\n\n      for (var i = 0, l = items.length; i < l; i++) {\n        heights.push(items[i].offsetHeight + marginBottom);\n      }\n    }\n\n    return heights;\n  },\n\n\n  /**\n   * @param {Element[]|NodeList} items\n   * @returns {number[]}\n   */\n  getItemHeights : function(items) {\n    var testColumn = this.createTestColumn(),\n        heights = [],\n        i = 0,\n        l = items.length;\n\n    for (i; i < l; i++) {\n      testColumn.appendChild(items[i]);\n    }\n\n    this.container.appendChild(testColumn);\n\n    var style = window.getComputedStyle(items[0]),\n        marginBottom = parseInt(style.marginBottom, 10);\n\n    for (i = 0; i < l; i++) {\n      heights.push(items[i].offsetHeight + marginBottom);\n    }\n\n    this.container.removeChild(testColumn);\n\n    return heights;\n  },\n\n\n  /**\n   *\n   */\n  refreshYIndices : function() {\n    var columns = this.container.children,\n        count = columns.length,\n        yIndices = this.yIndices;\n\n    if (count) {\n      yIndices.length = 0;\n\n      for (var i = 0; i < count; i++) {\n        yIndices.push(columns[i].offsetHeight);\n      }\n    }\n  },\n\n\n  /**\n   *\n   */\n  resetYIndices : function() {\n    var count = this.columnCount,\n        yIndices = this.yIndices;\n\n    yIndices.length = 0;\n\n    while (count--) {\n      yIndices.push(0);\n    }\n  },\n\n\n  /**\n   * @returns {DocumentFragment}\n   */\n  createColumns : function() {\n    var count = this.columnCount,\n        columns = document.createDocumentFragment(),\n        column;\n\n    while (count--) {\n      column = document.createElement('div');\n      column.className = this.columnClass;\n      columns.appendChild(column);\n    }\n\n    return columns;\n  },\n\n\n  /**\n   * @returns {DocumentFragment[]}\n   */\n  createColumnFragments : function() {\n    var columns = [],\n        count = this.columnCount;\n\n    while (count--) {\n      columns.push(document.createDocumentFragment());\n    }\n\n    return columns;\n  },\n\n\n  /**\n   * @returns {Element}\n   */\n  createTestColumn : function() {\n    var column = document.createElement('div'),\n        liveColumn = this.container.firstChild;\n\n    column.className = this.columnClass;\n    column.style.position = 'absolute';\n    column.style.left = '-10000px';\n    column.style.top = '-10000px';\n\n    if (liveColumn && liveColumn.className === this.columnClass) {\n      column.style.width = window.getComputedStyle(liveColumn).width;\n    }\n\n    return column;\n  },\n\n\n  /**\n   *\n   */\n  removeColumns : function() {\n    var container = this.container;\n\n    while (container.firstChild) {\n      container.removeChild(container.firstChild);\n    }\n  },\n\n\n  /**\n   * @param {Element|Element[]|NodeList} object\n   * @returns {Element[]}\n   */\n  toArray : function(object) {\n    if (isArray(object)) return object;\n\n    var i = object.length;\n\n    if (typeof i === 'number') {\n      var a = new Array(i);\n      while (i--) { a[i] = object[i]; }\n      return a;\n    }\n\n    return [object];\n  },\n\n\n  /**\n   * @param {{query:string, columns:number}[]} mediaQueries\n   */\n  bindToMediaQueries : function(mediaQueries) {\n    var i = mediaQueries.length;\n    while (i--) {\n      this.bindToMediaQueryList(mediaQueries[i]);\n    }\n  },\n\n\n  /**\n   * @param {{query:string, columns:number}} config\n   */\n  bindToMediaQueryList : function(config) {\n    var that = this;\n\n    var mqlListener = function(mql) {\n      if (mql.matches) {\n        that.update(config.columns);\n      }\n    };\n\n    var mediaQueryList = window.matchMedia(config.query);\n    mediaQueryList.addListener(mqlListener);\n    mqlListener(mediaQueryList);\n  }\n\n};\n\nreturn Quartz;\n}));\n"],"sourceRoot":"/source/"}